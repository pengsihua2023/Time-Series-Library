## losses说明
### 功能概述
该代码实现了一些用于时间序列预测任务的损失函数，这些损失函数主要评估预测值与目标值之间的误差，并适用于各种类型的时间序列模型（如 N-BEATS）。实现的损失函数包括：

1. **`mape_loss` (Mean Absolute Percentage Error, MAPE)**:
   衡量预测值相对于目标值的绝对百分比误差。

2. **`smape_loss` (Symmetric Mean Absolute Percentage Error, sMAPE)**:
   改进版的 MAPE，考虑了预测值和目标值的对称性，常用于时间序列预测。

3. **`mase_loss` (Mean Absolute Scaled Error, MASE)**:
   衡量预测值与目标值的误差，同时与基线模型的误差进行对比，用于标准化时间序列的误差评估。

---

### 详细功能说明

#### 1. `divide_no_nan` 函数
**功能**：
- 实现两个张量的除法操作，同时避免产生 `NaN` 或 `Inf` 值。
- 当除数为零或导致无效结果时，将输出设置为 `0`。

**参数**：
- `a`: 被除数张量。
- `b`: 除数张量。

**返回**：
- 除法结果，其中 `NaN` 或 `Inf` 被替换为 `0`。

---

#### 2. `mape_loss` 类
**功能**：
- 实现 MAPE 损失函数，用于衡量预测值与目标值之间的绝对百分比误差。
- 适用于目标值（`target`）非零的情况。

**损失公式**：
\[
\text{MAPE} = \frac{1}{N} \sum_{i=1}^N \left| \frac{\hat{y}_i - y_i}{y_i} \right|
\]
其中：
- \(\hat{y}_i\) 是预测值。
- \(y_i\) 是目标值。

**方法**：
1. 用 `divide_no_nan(mask, target)` 计算加权权重，避免除数为零。
2. 计算预测误差的加权绝对值，取均值。

**参数**：
- `insample`: 历史时间序列值（未在该损失中使用）。
- `freq`: 时间序列的频率（未在该损失中使用）。
- `forecast`: 模型的预测值。
- `target`: 真实目标值。
- `mask`: 0/1 的掩码，指示哪些值被用于计算。

**返回**：
- MAPE 损失值。

---

#### 3. `smape_loss` 类
**功能**：
- 实现 sMAPE 损失函数，适用于目标值和预测值都可能接近零的情况。
- sMAPE 是一种对称误差度量方式，避免了 MAPE 的单向性问题。

**损失公式**：
\[
\text{sMAPE} = \frac{200}{N} \sum_{i=1}^N \frac{|\hat{y}_i - y_i|}{|\hat{y}_i| + |y_i|}
\]

**方法**：
1. 计算预测值和目标值的绝对误差。
2. 使用预测值和目标值的绝对值之和进行归一化。
3. 应用掩码（`mask`）过滤无效值，取均值。

**参数**：
- 与 `mape_loss` 相同。

**返回**：
- sMAPE 损失值。

---

#### 4. `mase_loss` 类
**功能**：
- 实现 MASE 损失函数，通过与简单基线模型（滞后预测）的误差对比，提供更可靠的误差评估。
- 适用于季节性或周期性时间序列。

**损失公式**：

![image](https://github.com/user-attachments/assets/00c1d777-2d74-4003-8a4e-c16504518475)  


**方法**：
1. 计算基线误差：`insample` 数据的滞后（频率 `freq`）绝对差值均值。
2. 使用 `divide_no_nan` 计算每个样本的归一化权重。
3. 计算目标值和预测值误差的加权平均值。

**参数**：
- `insample`: 历史时间序列值，用于计算基线误差。
- `freq`: 时间序列的频率，用于滞后计算。
- 其他参数同上。

**返回**：
- MASE 损失值。

---

### 通用特点

1. **掩码支持**：
   - 所有损失函数都支持 `mask` 参数，允许在某些数据点上屏蔽误差计算（例如，处理缺失值或无效值）。

2. **数值稳定性**：
   - 使用 `divide_no_nan` 避免除以零或生成无效值，确保损失值的稳定性。

3. **灵活性**：
   - 适用于多种时间序列任务，涵盖百分比误差（MAPE、sMAPE）和缩放误差（MASE）。

---

### 应用场景

- **MAPE**：
  - 适合目标值为正的场景。
  - 不适合目标值接近零的场景。

- **sMAPE**：
  - 适合目标值可能为零或预测值接近零的场景。

- **MASE**：
  - 适合具有季节性或周期性特征的时间序列任务。
  - 提供与基线模型的对比，常用于模型性能的相对评估。

此代码为时间序列模型（如 N-BEATS）的训练和评估提供了灵活的损失函数实现。
