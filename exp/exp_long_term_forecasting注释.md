## exp_long_term_forecasting注释
这段代码属于一个继承自`Exp_Basic`的类`Exp_Long_Term_Forecast`，用于执行长期时间序列预测任务。该类扩展了基础类，实现了数据加载、模型构建、训练、验证、测试和结果保存等多个核心功能。具体功能如下：

### 初始化和模型构建
- `__init__`方法调用基类构造函数，初始化基本参数。
- `_build_model`方法根据参数构建对应的模型，支持多GPU环境。

### 数据加载
- `_get_data`方法从`data_provider`加载指定的数据集（训练、验证、测试）。

### 优化器和损失函数
- `_select_optimizer`方法创建Adam优化器。
- `_select_criterion`方法定义均方误差（MSE）作为损失函数。

### 训练和验证过程
- `train`方法执行模型的训练过程，包括早停策略以防止过拟合，并在每个epoch结束时打印训练、验证和测试损失。
- `vali`方法计算验证集上的平均损失。

### 测试和结果评估
- `test`方法对测试集进行预测，并根据需要加载训练好的模型。
- 测试结果会被保存，并计算各种评价指标，如均方误差（MSE）、平均绝对误差（MAE）和动态时间扭曲（DTW）。

### 结果保存
- 测试的预测结果和真实值被保存为NumPy数组。
- 计算得到的评价指标被保存，并输出到文本文件中。

### 可视化
- 在测试过程中，每20个批次可视化一次预测结果与真实值的对比，并保存为PDF文件。

### 高级特性
- 支持自动混合精度（AMP）训练，提高训练速度和效率。
- 实现动态学习率调整，以改善训练过程中的学习效率。

这个类提供了一个完整的长期时间序列预测解决方案，通过组织良好的模块化设计和灵活的参数配置，使其能够适应多种不同的预测任务和数据集。  
### 验证数据（vali data）的采用
在模型训练过程中，验证数据（vali data）用于周期性地评估模型以便进行调整和防止过拟合。然而，在整个训练流程结束后，测试数据（test data）被用来评估模型，这些评估结果（包括MSE和MAE）通常被视为模型在未见数据上的最终性能表现。这样做的目的是确保模型不仅能够适应训练数据，还能够有效地泛化到新的、未见过的数据上。  

在您的代码中，确实是这样处理的：  

训练阶段：使用验证数据来监控和调整模型，如早停（early stopping）等。  
测试阶段：使用测试数据来最终评估模型的性能。  
这是确保模型公正和有效评估的关键步骤，也是机器学习和数据科学项目中常见的最佳实践。  

在您提供的代码中，10%的测试数据被用于在模型的训练阶段之后进行验证，确保了模型的泛化能力。在训练的每个周期结束后，测试数据会被用来评估模型的性能，并非没有使用。这是通过以下几个步骤实现的：

1. **数据加载**：在`_get_data(flag='test')`方法中，根据传入的`flag`参数（这里是'test'），加载相应的数据集和数据加载器。

2. **模型评估**：在训练结束后（或者可能在训练的每个周期后），`test()`方法会被调用来对测试集进行评估。这是通过以下代码段实现的：
   ```python
   test_data, test_loader = self._get_data(flag='test')
   ```
   这里，`test_data`和`test_loader`用于从测试集中加载数据。

3. **性能计算**：在`test()`方法中，模型对测试集的数据执行预测，并且通过计算指标（如MSE，MAE等）来评估其性能。性能指标的计算在最后打印出来，并且可能被记录到日志文件中或保存到其他存储介质中。以下代码段显示了这一过程：
   ```python
   preds, trues = [], []
   for i, (batch_x, batch_y, batch_x_mark, batch_y_mark) in enumerate(test_loader):
       # 模型预测和计算逻辑
       ...
   mse, mae, dtw = metric(preds, trues)  # 计算性能指标
   print('mse:{}, mae:{}, dtw:{}'.format(mse, mae, dtw))
   ```

4. **结果输出**：测试阶段的结果被用于直接评估模型的最终表现，这通常是模型训练和调整参数过程中的最后一步。结果也可能用于比较不同模型配置的效果，或者用于科学研究和报告。

总结来说，测试数据在此代码中确实被使用，用于在训练过程结束后评估模型的性能，并帮助研究者或开发者理解模型在未见数据上的表现。这种做法符合机器学习模型开发的标准流程。
